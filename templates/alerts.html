{% extends "base.html" %}

{% block title %}Alerts - {{ app_name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-bell"></i> Alerts</h1>
    <a href="{{ url_for('prediction.list_alerts', household_id=household.id, show_read='true' if not show_read else 'false') }}" class="btn btn-outline-secondary">
        <i class="fas fa-{{ 'eye' if not show_read else 'eye-slash' }}"></i> {{ 'Show Read' if not show_read else 'Hide Read' }}
    </a>
</div>

<div class="card mb-3">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-6">
                <select class="form-select" name="household_id" onchange="this.form.submit()">
                    {% for h in households %}
                    <option value="{{ h.id }}" {% if h.id == household.id %}selected{% endif %}>
                        {{ h.household_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>
</div>

{% if alerts %}
<div class="list-group">
    {% for alert in alerts %}
    <div class="list-group-item {% if not alert.is_read %}border-start border-5 {% if alert.alert_type == 'High Risk' or alert.alert_type == 'Expired' %}border-danger{% else %}border-warning{% endif %}{% endif %}">
        <div class="d-flex justify-content-between align-items-start">
            <div class="flex-grow-1">
                <div class="d-flex align-items-center mb-2">
                    <span class="badge bg-{{ 'danger' if alert.alert_type == 'High Risk' or alert.alert_type == 'Expired' else 'warning' }} me-2">
                        {{ alert.alert_type }}
                    </span>
                    <small class="text-muted">{{ alert.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                </div>
                <h6 class="mb-2">{{ alert.food_item.item_name }}</h6>
                <p class="mb-2">{{ alert.alert_message }}</p>
                {% if alert.recommendation %}
                <div class="alert alert-info mb-0 py-2">
                    <small><i class="fas fa-lightbulb"></i> {{ alert.recommendation }}</small>
                </div>
                {% endif %}
            </div>
            <div class="ms-3">
                <a href="{{ url_for('food.view_food_item', item_id=alert.food_item_id) }}" class="btn btn-sm btn-outline-primary mb-2">
                    <i class="fas fa-eye"></i> View
                </a>
                {% if not alert.is_read %}
                <form method="POST" action="{{ url_for('prediction.mark_alert_read', alert_id=alert.id) }}">
                    <button type="submit" class="btn btn-sm btn-outline-success">
                        <i class="fas fa-check"></i> Mark Read
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
    <h3>No Alerts</h3>
    <p class="text-muted">You're all caught up!</p>
</div>
{% endif %}
{% endblock %}