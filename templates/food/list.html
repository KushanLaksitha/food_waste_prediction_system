{% extends "base.html" %}

{% block title %}Food Items - {{ app_name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-utensils"></i> Food Inventory</h1>
    <a href="{{ url_for('food.add_food_item') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add Food Item
    </a>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-3">
                <label for="household_id" class="form-label">Household</label>
                <select class="form-select" id="household_id" name="household_id" onchange="this.form.submit()">
                    {% for h in households %}
                    <option value="{{ h.id }}" {% if h.id == household.id %}selected{% endif %}>
                        {{ h.household_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="status" class="form-label">Status</label>
                <select class="form-select" id="status" name="status" onchange="this.form.submit()">
                    <option value="Active" {% if selected_status == 'Active' %}selected{% endif %}>Active</option>
                    <option value="Consumed" {% if selected_status == 'Consumed' %}selected{% endif %}>Consumed</option>
                    <option value="Wasted" {% if selected_status == 'Wasted' %}selected{% endif %}>Wasted</option>
                    <option value="Donated" {% if selected_status == 'Donated' %}selected{% endif %}>Donated</option>
                    <option value="All" {% if selected_status == 'All' %}selected{% endif %}>All</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="category_id" class="form-label">Category</label>
                <select class="form-select" id="category_id" name="category_id" onchange="this.form.submit()">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                        {{ category.category_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <a href="{{ url_for('food.list_food_items') }}" class="btn btn-secondary w-100">
                    <i class="fas fa-redo"></i> Reset
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Food Items Table -->
<div class="card">
    <div class="card-body">
        {% if food_items %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Category</th>
                        <th>Quantity</th>
                        <th>Purchase Date</th>
                        <th>Expiry Date</th>
                        <th>Days Left</th>
                        <th>Status</th>
                        <th>Risk Score</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in food_items %}
                    <tr>
                        <td>
                            <strong>{{ item.item_name }}</strong>
                        </td>
                        <td>
                            <span class="badge bg-secondary">{{ item.category.category_name }}</span>
                        </td>
                        <td>{{ item.quantity }} {{ item.unit }}</td>
                        <td>{{ item.purchase_date.strftime('%Y-%m-%d') }}</td>
                        <td>{{ item.expiry_date.strftime('%Y-%m-%d') }}</td>
                        <td>
                            {% if item.days_until_expiry is not none %}
                                {% if item.days_until_expiry < 0 %}
                                    <span class="text-danger"><strong>Expired</strong></span>
                                {% elif item.days_until_expiry <= 3 %}
                                    <span class="text-danger">{{ item.days_until_expiry }} days</span>
                                {% elif item.days_until_expiry <= 7 %}
                                    <span class="text-warning">{{ item.days_until_expiry }} days</span>
                                {% else %}
                                    <span class="text-success">{{ item.days_until_expiry }} days</span>
                                {% endif %}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-{% if item.status == 'Active' %}success{% elif item.status == 'Consumed' %}info{% elif item.status == 'Wasted' %}danger{% else %}secondary{% endif %}">
                                {{ item.status }}
                            </span>
                        </td>
                        <td>
                            {% if item.status == 'Active' %}
                                <span class="badge bg-{{ 'danger' if item.waste_risk_score|float >= 70 else ('warning' if item.waste_risk_score|float >= 40 else 'success') }}">
                                    {{ "%.0f"|format(item.waste_risk_score) }}%
                                </span>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{{ url_for('food.view_food_item', item_id=item.id) }}" class="btn btn-outline-info" title="View">
                                    <i class="fas fa-eye"></i>
                                </a>
                                {% if item.status == 'Active' %}
                                <a href="{{ url_for('food.edit_food_item', item_id=item.id) }}" class="btn btn-outline-primary" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{{ url_for('prediction.view_recommendations', item_id=item.id) }}" class="btn btn-outline-success" title="Recommendations">
                                    <i class="fas fa-lightbulb"></i>
                                </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
            <p class="text-muted">No food items found. Start by adding some!</p>
            <a href="{{ url_for('food.add_food_item') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Food Item
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}